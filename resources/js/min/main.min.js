function rollData(l,o,e,r,t,i){this.dice_amount=l,this.faces_amount=o,this.individual_rolls=e,this.modifier=r,this.mod_type=t,this.result=i,this.display_modifier=r>=0?"+ "+r.toString():"- "+(-1*r).toString()}function smoothScrollTo(l,o,e){window.setTimeout(function(){$("html, body").animate({scrollTop:$(l).offset().top},e)},o)}function incrementInputFields(l){isNaN($(document.activeElement).val())||("up"===l?$(document.activeElement).val(function(){return parseInt(this.value)+1}):"down"===l&&$(document.activeElement).val(function(){return parseInt(this.value)-1}))}function randomNumberBetween(l,o){var e=o-l;return Math.ceil(Math.random()*e)+l}function cleanFields(){var l;l="+"===$("#modifier").val()[0]?$("#modifier").val().substr(1):$("#modifier").val(),$("#modifier").val(l),["#dice-amount","#faces-amount","#modifier"].forEach(function(l){0===$(l).val().length?$(l).val("0"):$(l).val()})}function getRollShorthand(){var l,o=_r.roll.display_modifier.replace(/ /g,"");return l=0!=_r.roll.modifier?2===_r.roll.mod_type?_r.roll.dice_amount+"(d"+_r.roll.faces_amount+o+")":"("+_r.roll.dice_amount+"d"+_r.roll.faces_amount+")"+o:_r.roll.dice_amount+"d"+_r.roll.faces_amount}function getFormattedIndividualRolls(l){var o=l.display_modifier.replace(/ /g,"&nbsp;"),e=_r.roll.display_modifier.replace(/ /g,"");if(1===l.mod_type&&0!=l.modifier)var r=l.individual_rolls.join(", ")+" "+o;else if(2===l.mod_type&&0!=l.modifier)var r=l.individual_rolls.map(function(l){return l.toString()+e}).join(", ");else var r=l.individual_rolls.join(", ");return r}function storeDiceRoll(){for(var l=1,o=parseInt($("#dice-amount").val()),e=parseInt($("#faces-amount").val()),r=parseInt($("#modifier").val()),t=[],i=0,n=0;o>n;n++)t.push(randomNumberBetween(0,e));t.forEach(function(l){i+=l}),1===l?i+=r:2===l&&(i+=r*o);var a=new rollData(o,e,t,r,l,i);_r.roll_history.push(a),_r.roll=_r.roll_history[_r.roll_history.length-1]}function hideIrrelevantSections(){function l(){$(".individual-rolls").css("display","inline-block"),$(".total").removeClass("pure-u-1").addClass("pure-u-1-2"),$(".total h1").html("Result")}l(),1===_r.roll.dice_amount&&0===_r.roll.modifier&&($(".individual-rolls").css("display","none"),$(".total").removeClass("pure-u-1-2").addClass("pure-u-1"),$(".total h1").html("Rolled "+getRollShorthand(_r.roll)))}function keepResultVisible(){var l=($(window).width()-$("main").width())/2;$(window).scrollTop()>$("#results").offset().top&&(_r.roll.dice_amount>1||0!=_r.roll.modifier)?($(".total span").addClass("stickied-total"),$(".stickied-total").css({right:l+"px"})):$(".total span").removeClass("stickied-total")}function displayRollResult(){function l(){hideIrrelevantSections(),$("#results").removeClass("closed"),$(".individual-rolls h1").html("Rolled "+getRollShorthand(_r.roll)),$(".individual-rolls span").html(getFormattedIndividualRolls(_r.roll)),$(".total span").html(_r.roll.result)}_r.currently_rolling=!0,$(".results-grid").addClass("faded-out"),window.setTimeout(function(){l()},_r.roll_speed/2),window.setTimeout(function(){$(".results-grid").removeClass("faded-out"),_r.currently_rolling=!1},_r.roll_speed)}function logToRollHistoryWindow(l){var o=document.createElement("li"),e=document.createElement("div"),r=document.createElement("div"),t=document.createElement("div");$(o).addClass("pure-g roll-data-item"),$(e).addClass("pure-u-1-4 archive-shorthand"),$(r).addClass("pure-u-1-2 archive-individual-rolls"),$(t).addClass("pure-u-1-4 archive-total"),$(e).html(getRollShorthand(l)),$(r).html(getFormattedIndividualRolls(l)),$(t).html(l.result),$(o).append(e,r,t),$(".roll-history ul").prepend(o)}function openOverlay(){$(".overlay").css("display","block"),window.setTimeout(function(){$(".overlay").removeClass("closed")},10)}function closeOverlay(){$(".overlay").addClass("closed"),window.setTimeout(function(){$(".overlay").css("display","none")},400)}function rollDice(){_r.currently_rolling||(cleanFields(),storeDiceRoll(),logToRollHistoryWindow(_r.roll),displayRollResult(),smoothScrollTo("#results",_r.roll_speed,500))}var _r={roll_history:[],roll_speed:400,currently_rolling:!1,roll:null};